<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.sheetjs.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://*.supabase.co; frame-ancestors 'none'; base-uri 'self'; form-action 'self'; upgrade-insecure-requests;">
    <title>CMMC 2.0 Assessment Tool</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css?v=1">
    <link rel="stylesheet" href="css/themes.css?v=1">
    <link rel="stylesheet" href="css/theme-picker.css?v=1">
    <link rel="stylesheet" href="css/modal.css?v=1">
    <link rel="stylesheet" href="css/comprehensive-guidance.css?v=20260205e">
    <link rel="stylesheet" href="css/crosswalk.css?v=20260126b">
    <link rel="stylesheet" href="css/impl-planner.css?v=2">
    <link rel="stylesheet" href="css/osc-inventory.css?v=5">
    <link rel="stylesheet" href="css/arch-guide.css?v=10">
    <link rel="stylesheet" href="css/enhanced-features.css?v=1">
    <link rel="stylesheet" href="css/msp-portal.css?v=1">
    <link rel="stylesheet" href="styles/api-tester.css?v=1">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Development Disclaimer Banner -->
    <div id="disclaimer-banner" class="disclaimer-banner">
        <div class="disclaimer-content">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
            <span><strong>Disclaimer:</strong> This tool is in active development and provided for <strong>informational purposes only</strong>. All content is derived from public domain sources (NIST, DoD, FedRAMP). This is not legal or compliance advice. No warranties are provided.</span>
            <button class="disclaimer-close" onclick="this.closest('.disclaimer-banner').remove()" aria-label="Dismiss">&times;</button>
        </div>
    </div>

    <!-- Top Header Bar -->
    <header class="top-header-bar">
        <button class="hb-toggle" id="hamburger-menu-toggle" aria-label="Toggle menu">
            <span class="hb-toggle-bar"></span>
            <span class="hb-toggle-bar"></span>
            <span class="hb-toggle-bar"></span>
        </button>
        <div class="header-branding" id="header-branding" style="cursor: pointer;" title="Go to Dashboard">
            <span class="header-badge">CMMC 2.0</span>
            <span class="header-title">Assessment Tool</span>
        </div>
        <div class="header-theme-picker" id="header-theme-picker"></div>
    </header>

    <!-- Slide-out Navigation Panel -->
    <div class="hb-overlay" id="hamburger-overlay"></div>
    <aside class="hb-panel" id="hamburger-dropdown">
        <!-- Panel Header -->
        <div class="hb-panel-header">
            <span class="hb-panel-badge">CMMC 2.0</span>
            <span class="hb-panel-title">Navigation</span>
            <button class="hb-close" id="hb-close-btn" aria-label="Close menu">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>

        <!-- Scrollable Nav Content -->
        <div class="hb-scroll">
            <nav class="hb-nav">
                <!-- Core -->
                <div class="hb-group">
                    <button class="hamburger-nav-btn active" data-view="dashboard">
                        <span class="hb-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg></span>
                        <span class="hb-label">Dashboard</span>
                    </button>
                    <button class="hamburger-nav-btn" data-view="assessment">
                        <span class="hb-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg></span>
                        <span class="hb-label">Assessment</span>
                    </button>
                </div>

                <!-- Planning & Remediation -->
                <div class="hb-group">
                    <div class="hb-section-label">Planning & Remediation</div>
                    <button class="hamburger-nav-btn" data-view="poam">
                        <span class="hb-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></span>
                        <span class="hb-label">POA&amp;M</span>
                    </button>
                    <button class="hamburger-nav-btn" data-view="impl-planner">
                        <span class="hb-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="2"/><path d="M9 14l2 2 4-4"/></svg></span>
                        <span class="hb-label">Implementation Planner</span>
                    </button>
                    <button class="hamburger-nav-btn hb-sub" id="run-gap-analysis-btn">
                        <span class="hb-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg></span>
                        <span class="hb-label">Gap Analysis</span>
                    </button>
                </div>

                <!-- Documentation & Guidance -->
                <div class="hb-group">
                    <div class="hb-section-label">Documentation & Guidance</div>
                    <button class="hamburger-nav-btn" id="open-document-parser-btn">
                        <span class="hb-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></span>
                        <span class="hb-label">Document Parser</span>
                    </button>
                    <button class="hamburger-nav-btn" data-view="impl-guide">
                        <span class="hb-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg></span>
                        <span class="hb-label">Architecture Guide</span>
                    </button>
                </div>

                <!-- Assets -->
                <div class="hb-group">
                    <div class="hb-section-label">System & Assets</div>
                    <button class="hamburger-nav-btn" data-view="osc-inventory">
                        <span class="hb-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></span>
                        <span class="hb-label">Asset Inventory</span>
                    </button>
                </div>

                <!-- Framework Mapping -->
                <div class="hb-group">
                    <div class="hb-section-label">Framework Mapping</div>
                    <button class="hamburger-nav-btn" data-view="crosswalk">
                        <span class="hb-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg></span>
                        <span class="hb-label">Crosswalk Viewer</span>
                    </button>
                    <button class="hamburger-nav-btn hb-sub" id="open-rev3-crosswalk-btn">
                        <span class="hb-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 3h5v5"/><path d="M21 3l-7 7"/></svg></span>
                        <span class="hb-label">Rev2 &rarr; Rev3 Crosswalk</span>
                    </button>
                </div>

                <!-- Reporting -->
                <div class="hb-group">
                    <div class="hb-section-label">Reporting</div>
                    <button class="hamburger-nav-btn" id="open-executive-dashboard-btn">
                        <span class="hb-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg></span>
                        <span class="hb-label">Executive Dashboard</span>
                    </button>
                </div>

                <!-- MSP -->
                <div class="hb-group">
                    <div class="hb-section-label">MSP Tools</div>
                    <button class="hamburger-nav-btn" id="open-msp-portal-btn">
                        <span class="hb-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg></span>
                        <span class="hb-label">MSP Portal</span>
                    </button>
                </div>
            </nav>

            <!-- Organization Info -->
            <div class="hb-org-section">
                <div class="hb-section-label" style="padding: 0 0 8px 0;">Organizations</div>
                <div class="hb-org-card">
                    <div class="hb-org-header">
                        <div class="hb-org-logo" id="assessor-logo-container">
                            <img id="assessor-logo-img" class="hamburger-logo-img" style="display: none;" alt="Logo">
                            <div class="hamburger-logo-placeholder" id="assessor-logo-placeholder">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                            </div>
                        </div>
                        <div class="hb-org-info">
                            <span class="hb-org-tag">Assessor</span>
                            <input type="text" id="org-assessor-name" class="hb-org-input" placeholder="Company Name">
                        </div>
                    </div>
                    <div class="hb-org-url-row">
                        <input type="text" id="org-assessor-url" class="hb-org-url" placeholder="website.com">
                        <button id="fetch-assessor-logo-btn" class="hb-fetch-btn" title="Fetch logo">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 12a9 9 0 11-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>
                        </button>
                    </div>
                    <input type="file" id="assessor-logo-input" accept="image/*" style="display: none;">
                </div>
                <div class="hb-org-card">
                    <div class="hb-org-header">
                        <div class="hb-org-logo" id="osc-logo-container">
                            <img id="osc-logo-img" class="hamburger-logo-img" style="display: none;" alt="Logo">
                            <div class="hamburger-logo-placeholder" id="osc-logo-placeholder">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                            </div>
                        </div>
                        <div class="hb-org-info">
                            <span class="hb-org-tag">OSC</span>
                            <input type="text" id="org-osc-name" class="hb-org-input" placeholder="Company Name">
                        </div>
                    </div>
                    <div class="hb-org-url-row">
                        <input type="text" id="org-osc-url" class="hb-org-url" placeholder="website.com">
                        <button id="fetch-osc-logo-btn" class="hb-fetch-btn" title="Fetch logo">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 12a9 9 0 11-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>
                        </button>
                    </div>
                    <input type="file" id="osc-logo-input" accept="image/*" style="display: none;">
                </div>
            </div>
        </div>

        <!-- Panel Footer -->
        <div class="hb-panel-footer">
            <div class="auth-container" id="auth-container"></div>
        </div>
    </aside>
    
    <!-- Mobile Menu Toggle (legacy) -->
    <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle menu" style="display:none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
    </button>
    <div class="mobile-overlay" id="mobile-overlay"></div>
    
    <div class="app-container no-sidebar">
        <!-- Main Content -->
        <main class="main-content">
            <!-- Assessment View -->
            <div id="assessment-view" class="view">
                <header class="view-header">
                    <div class="header-left">
                        <h2>Assessment Objectives</h2>
                        <p class="subtitle">Mark each objective as Met, Not Met, or Partial</p>
                    </div>
                    <div class="header-right">
                        <select id="assessment-level-select" class="filter-select level-select">
                            <option value="2">CMMC Level 2</option>
                            <option value="1">CMMC Level 1</option>
                            <option value="3">CMMC Level 3</option>
                        </select>
                        <button class="search-box search-trigger" id="search-trigger" title="Search (⌘K)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                            <span class="search-placeholder">Search...</span>
                            <kbd class="search-shortcut">⌘K</kbd>
                        </button>
                        <div class="search-box-inline" style="display:none;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                            <input type="text" id="search-input" placeholder="Search objectives...">
                        </div>
                        <select id="filter-status" class="filter-select">
                            <option value="all">All Status</option>
                            <option value="not-assessed">Not Assessed</option>
                            <option value="met">Met</option>
                            <option value="not-met">Not Met</option>
                            <option value="partial">Partial</option>
                        </select>
                        <select id="filter-family" class="filter-select">
                            <option value="all">All Families</option>
                        </select>
                        <button id="mark-all-not-met-btn" class="action-btn warning">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
                            Mark All Not Met
                        </button>
                        <button id="export-assessment-btn" class="action-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                            Export Assessment
                        </button>
                    </div>
                </header>
                <div class="progress-bar-container">
                    <div class="progress-stats">
                        <span id="progress-text">0 of 0 assessed</span>
                        <span id="compliance-text">0% compliant</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-met" id="progress-met"></div>
                        <div class="progress-partial" id="progress-partial"></div>
                        <div class="progress-not-met" id="progress-not-met"></div>
                    </div>
                </div>
                <div id="controls-list" class="controls-list"></div>
            </div>

            <!-- POA&M View -->
            <div id="poam-view" class="view">
                <header class="view-header">
                    <div class="header-left">
                        <h2>Plan of Action & Milestones</h2>
                        <p class="subtitle">Items marked as Not Met or Partial</p>
                    </div>
                    <div class="header-right">
                        <button id="save-btn" class="action-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                            Save
                        </button>
                        <button id="load-btn" class="action-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                            Load
                        </button>
                        <button id="export-btn" class="action-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                            Export Excel
                        </button>
                        <button id="export-csv-btn" class="action-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                            Export CSV
                        </button>
                    </div>
                </header>
                <div id="poam-content" class="poam-content"></div>
            </div>

            <!-- Dashboard View -->
            <div id="dashboard-view" class="view active">
                <!-- Hero Title for Dashboard -->
                <div class="dashboard-hero">
                    <div class="hero-badge">CMMC 2.0</div>
                    <h1 class="hero-title">Assessment Tool</h1>
                    <p class="hero-subtitle">Self-Assessment, POA&M Generator, and Control Mapping Tool</p>
                </div>
                <header class="view-header dashboard-header-row">
                    <div class="header-left">
                        <h2>Compliance Dashboard</h2>
                        <p class="subtitle">Overview of assessment status by control family</p>
                    </div>
                    <div class="header-right dashboard-scores-inline" id="dashboard-header-scores">
                        <!-- SPRS, Conditional scores, and theme picker rendered by app.js -->
                    </div>
                </header>
                <div id="dashboard-content" class="dashboard-content"></div>
            </div>

            <!-- Implementation Guide View (Legacy - Architecture) -->
            <div id="impl-guide-view" class="view">
                <div id="impl-guide-content" class="impl-guide-content">
                    <!-- Content rendered by app.js -->
                </div>
            </div>

            <!-- Implementation Planner View (New) -->
            <div id="impl-planner-view" class="view">
                <div id="impl-planner-content" class="impl-planner-container">
                    <!-- Content rendered by app.js -->
                </div>
            </div>

            <!-- OSC Inventory View -->
            <div id="osc-inventory-view" class="view">
                <div id="osc-inventory-content" class="osc-inventory-container">
                    <!-- Content rendered by app.js -->
                </div>
            </div>

            <!-- Rev2 to Rev3 Crosswalk View -->
            <div id="rev3-crosswalk-view" class="view">
                <header class="view-header">
                    <div class="header-left">
                        <h2>NIST 800-171A Rev2 → Rev3 Crosswalk</h2>
                        <p class="subtitle">Control mapping with DoD-Defined ODPs (2025)</p>
                    </div>
                    <div class="header-right">
                        <div class="rev3-xwalk-tabs">
                            <button class="xwalk-tab active" data-tab="mapping" onclick="Rev3Crosswalk.switchTab('mapping')">Rev2→Rev3</button>
                            <button class="xwalk-tab" data-tab="sp53" onclick="Rev3Crosswalk.switchTab('sp53')">800-53→171</button>
                            <button class="xwalk-tab" data-tab="odps" onclick="Rev3Crosswalk.switchTab('odps')">DoD ODPs</button>
                            <button class="xwalk-tab" data-tab="new" onclick="Rev3Crosswalk.switchTab('new')">New Controls</button>
                        </div>
                    </div>
                </header>
                <div id="rev3-crosswalk-content" class="rev3-crosswalk-container">
                    <!-- Content rendered by Rev3Crosswalk.renderView() -->
                </div>
            </div>

            <!-- Crosswalk Visualizer View -->
            <div id="crosswalk-view" class="view">
                <header class="view-header">
                    <div class="header-left">
                        <h2>Control Crosswalk</h2>
                        <p class="subtitle">Explore mappings between CMMC, NIST 800-171, NIST 800-53, and FedRAMP</p>
                    </div>
                    <div class="header-right">
                        <div class="crosswalk-view-toggle">
                            <button class="toggle-btn active" data-mode="table">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="3" y1="15" x2="21" y2="15"/><line x1="9" y1="3" x2="9" y2="21"/></svg>
                                Table
                            </button>
                            <button class="toggle-btn" data-mode="graph">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
                                Graph
                            </button>
                        </div>
                    </div>
                </header>
                <div class="crosswalk-filters">
                    <div class="filter-group">
                        <label>FedRAMP 20x KSI Family</label>
                        <select id="crosswalk-family-filter">
                            <option value="all">All 20x Families (11)</option>
                            <option value="AFR">AFR — Authorization by FedRAMP</option>
                            <option value="CED">CED — Cybersecurity Education</option>
                            <option value="CMT">CMT — Change Management</option>
                            <option value="CNA">CNA — Cloud Native Architecture</option>
                            <option value="IAM">IAM — Identity & Access Management</option>
                            <option value="INR">INR — Incident Response</option>
                            <option value="MLA">MLA — Monitoring, Logging & Auditing</option>
                            <option value="PIY">PIY — Policy and Inventory</option>
                            <option value="RPL">RPL — Recovery Planning</option>
                            <option value="SVC">SVC — Service Configuration</option>
                            <option value="TPR">TPR — Third-Party Resources</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>FedRAMP 20x Baseline</label>
                        <select id="crosswalk-baseline-filter">
                            <option value="all">All KSIs (61)</option>
                            <option value="low">FedRAMP 20x Low (56 KSIs)</option>
                            <option value="moderate">FedRAMP 20x Moderate (61 KSIs)</option>
                            <option value="moderate-only">Moderate-Only (5 KSIs)</option>
                        </select>
                    </div>
                    <div class="filter-group search-filter">
                        <label>Search</label>
                        <input type="text" id="crosswalk-search" placeholder="Search KSIs...">
                    </div>
                    <div class="filter-group export-group">
                        <label>Export FedRAMP 20x KSI</label>
                        <div class="export-buttons">
                            <button class="export-btn json-btn" onclick="CrosswalkVisualizer.exportKSIJSON()" title="Export as JSON">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                JSON
                            </button>
                            <button class="export-btn csv-btn" onclick="CrosswalkVisualizer.exportKSICSV()" title="Export as CSV">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                CSV
                            </button>
                        </div>
                    </div>
                    <div class="filter-group export-group">
                        <label>Export NIST 800-53A</label>
                        <div class="export-buttons">
                            <button class="export-btn json-btn nist-53-btn" onclick="CrosswalkVisualizer.export80053JSON()" title="Export NIST 800-53A as JSON">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                JSON
                            </button>
                            <button class="export-btn csv-btn nist-53-btn" onclick="CrosswalkVisualizer.export80053CSV()" title="Export NIST 800-53A as CSV">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                CSV
                            </button>
                        </div>
                    </div>
                </div>
                <div id="crosswalk-content" class="crosswalk-content">
                    <div id="crosswalk-table-view" class="crosswalk-table-container"></div>
                    <div id="crosswalk-graph-view" class="crosswalk-graph-container" style="display: none;">
                        <div id="graph-selector-container" class="graph-selector-container" style="display: none;">
                            <label for="graph-control-selector">Select KSI:</label>
                            <select id="graph-control-selector"></select>
                        </div>
                        <canvas id="crosswalk-canvas"></canvas>
                        <div id="graph-tooltip" class="graph-tooltip"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal for Implementation Notes (Assessment View) -->
    <div id="implementation-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Implementation Details</h3>
                <button class="modal-close" onclick="app.closeImplementationModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="implementation-form">
                    <input type="hidden" id="impl-objective-id">
                    <div class="form-group">
                        <label>Control / Objective</label>
                        <input type="text" id="impl-control-id" readonly>
                    </div>
                    <div class="form-group">
                        <label>Objective Requirement</label>
                        <textarea id="impl-requirement" rows="2" readonly></textarea>
                    </div>
                    <div class="form-group">
                        <label>How is this objective met?</label>
                        <textarea id="impl-description" rows="4" placeholder="Describe how this control objective is implemented..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Evidence / Documentation</label>
                        <textarea id="impl-evidence" rows="3" placeholder="Reference policies, procedures, screenshots, or other evidence..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Responsible Party</label>
                            <input type="text" id="impl-responsible" placeholder="Name or role...">
                        </div>
                        <div class="form-group">
                            <label>Last Verified</label>
                            <input type="date" id="impl-verified-date">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Additional Notes</label>
                        <textarea id="impl-notes" rows="2" placeholder="Any additional notes..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-cancel" onclick="app.closeImplementationModal()">Cancel</button>
                        <button type="submit" class="btn-save">Save Implementation Details</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal for POA&M Details -->
    <div id="poam-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>POA&M Entry Details</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="poam-form">
                    <input type="hidden" id="poam-objective-id">
                    <div class="form-group">
                        <label>Control ID</label>
                        <input type="text" id="poam-control-id" readonly>
                    </div>
                    <div class="form-group">
                        <label>Weakness Description</label>
                        <textarea id="poam-weakness" rows="3" placeholder="Describe the weakness or gap..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Weakness Identifying Party</label>
                        <select id="poam-identifying-party">
                            <option value="">-- Select --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Remediation Plan</label>
                        <textarea id="poam-remediation" rows="3" placeholder="Describe the plan to address this weakness..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Scheduled Completion Date</label>
                            <input type="date" id="poam-date">
                        </div>
                        <div class="form-group">
                            <label>Responsible Party</label>
                            <input type="text" id="poam-responsible" placeholder="Name or role...">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Risk Level</label>
                            <select id="poam-risk">
                                <option value="low">Low</option>
                                <option value="moderate">Moderate</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Estimated Cost</label>
                            <input type="text" id="poam-cost" placeholder="$0.00">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="poam-notes" rows="2" placeholder="Additional notes..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-cancel">Cancel</button>
                        <button type="submit" class="btn-save">Save POA&M Entry</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Cmd+K Search Modal -->
    <div id="search-modal" class="search-modal">
        <div class="search-modal-backdrop"></div>
        <div class="search-modal-content">
            <div class="search-modal-header">
                <div class="search-input-wrapper">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    <input type="text" id="search-modal-input" placeholder="Search controls, objectives, or keywords..." autocomplete="off">
                    <kbd class="search-kbd">ESC</kbd>
                </div>
            </div>
            <div class="search-modal-results" id="search-modal-results">
                <div class="search-empty-state">
                    <p>Start typing to search across all controls and objectives</p>
                    <div class="search-hints">
                        <span><kbd>↑</kbd><kbd>↓</kbd> Navigate</span>
                        <span><kbd>Enter</kbd> Select</span>
                        <span><kbd>ESC</kbd> Close</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Implementation Guide Modal -->
    <div id="impl-guide-modal" class="impl-guide-modal">
        <div class="impl-guide-backdrop"></div>
        <div class="impl-guide-content">
            <div class="impl-guide-header">
                <div class="impl-guide-title-row">
                    <h2 id="impl-guide-title">GCC High Implementation Guide</h2>
                    <select id="impl-cloud-selector" class="impl-cloud-selector">
                        <option value="azure">Azure / M365 GCC High</option>
                        <option value="aws">AWS GovCloud</option>
                        <option value="gcp">GCP / Google Workspace</option>
                    </select>
                </div>
                <p class="impl-guide-subtitle" id="impl-guide-subtitle">CMMC L2 Deployment Resources for M365 GCC High / Azure Government</p>
                <button class="impl-guide-close" id="close-impl-guide-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="impl-guide-tabs" id="impl-guide-tabs">
                <button class="impl-tab active" data-tab="project-plan">Project Plan</button>
                <button class="impl-tab" data-tab="evidence">Evidence Strategy</button>
                <button class="impl-tab" data-tab="policies">Policy Templates</button>
                <button class="impl-tab" data-tab="ssp">SSP Statements</button>
                <button class="impl-tab" data-tab="services">Services</button>
                <button class="impl-tab" data-tab="extras">Extras</button>
            </div>
            <div class="impl-guide-body" id="impl-guide-body">
                <!-- Content loaded dynamically -->
            </div>
            <div class="impl-guide-footer">
                <button class="impl-export-btn" id="export-project-plan-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    Export CSV
                </button>
            </div>
        </div>
    </div>

    <!-- Data Storage Notice -->
    <div id="data-storage-notice" class="data-storage-notice">
        <div class="notice-content">
            <div class="notice-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            </div>
            <div class="notice-text">
                <strong>Your data stays in your browser</strong>
                <p>Favorites, notes, and preferences are saved locally using browser storage. No data is sent to our servers. Avoid storing sensitive information as browser data can be accessed by other scripts or cleared unexpectedly.</p>
            </div>
            <button id="acknowledge-notice-btn" class="acknowledge-btn">Acknowledged</button>
        </div>
    </div>

    <!-- External CDNs - defer loading -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
    
    <!-- Core data files - needed for initial render -->
    <script src="data/families-ac-at-au.js"></script>
    <script src="data/families-cm-ia.js"></script>
    <script src="data/families-ir-ma-mp-ps-pe.js"></script>
    <script src="data/families-ra-ca-sc-si.js"></script>
    <script src="data/sprs-scoring.js"></script>
    <script src="data/ctrl-xref.js?v=2"></script>
    <script src="data/related-objectives.js?v=1"></script>
    <script src="data/enclave-guidance.js?v=8"></script>
    <script src="data/cca-questions.js?v=2"></script>
    <script src="data/cca-pitfalls.js?v=1"></script>
    <script src="data/loader.js"></script>
    
    <!-- NIST 800-172A (CMMC L3) and Rev 3 Migration -->
    <script src="data/nist-800-172a.js?v=1"></script>
    <script src="data/nist-800-171a-r3.js?v=1"></script>
    <script src="data/nist-800-53-to-171-mapping.js?v=1"></script>
    <script src="data/cca-interview-questions.js?v=1"></script>
    
    <!-- MSP Portal Data -->
    <script src="data/msp-portal-data.js?v=1"></script>
    <script src="data/msp-automation-platforms.js?v=1"></script>
    <script src="data/msp-cloud-templates.js?v=1"></script>
    <script src="data/msp-evidence-lists.js?v=1"></script>
    <script src="data/msp-data-protection.js?v=1"></script>
    <script src="data/api-evidence-collection.js?v=1"></script>
    
    <!-- Lazy-loaded scripts - loaded on demand by LazyLoader -->
    <!-- implementation-planner.js, gcc-high-*.js, aws-*.js, gcp-*.js, 
         framework-mappings.js, crosswalk-visualizer.js, enclave-guidance.js,
         fedramp-20x-ksi.js, nist-800-53a.js, itar-guidance.js, impl-notes.js -->
    
    <!-- Temporarily loading implementation planner directly to bypass lazy loader -->
    <script src="data/implementation-planner-clean.js?v=4"></script>
    
    <!-- Core app scripts -->
    <script src="js/lazy-loader.js?v=3"></script>
    <script src="js/skeleton-loader.js?v=1"></script>
    <script src="js/osc-inventory.js?v=7"></script>
    
    <!-- Security Modules (Load Before App) -->
    <script src="js/security.js?v=2"></script>
    <script src="js/session-manager.js?v=1"></script>
    <script src="js/secure-storage.js?v=1"></script>
    <script src="js/csrf-protection.js?v=1"></script>
    <script src="js/security-monitor.js?v=1"></script>
    <script src="js/integrity-validator.js?v=1"></script>
    
    <!-- Load comprehensive guidance data BEFORE app-main.js -->
    <script src="data/comprehensive-implementation-guidance.js?v=20260205f"></script>
    <script src="data/comprehensive-guidance-expansion-part2.js?v=20260205f"></script>
    <script src="data/comprehensive-guidance-expansion-part3.js?v=20260205f"></script>
    <script src="data/comprehensive-guidance-expansion-part4.js?v=20260205f"></script>
    <script src="data/comprehensive-guidance-expansion-part5.js?v=20260205f"></script>
    <script src="js/comprehensive-guidance-ui.js?v=20260205f"></script>
    
    <script src="app-main.js"></script>
    <script src="js/supabase-client.js?v=1" defer></script>
    <script src="js/evidence-ui.js?v=1" defer></script>
    <script src="js/theme-picker.js?v=5"></script>
    
    <!-- Enhanced Features -->
    <script src="js/report-generator.js?v=1" defer></script>
    <script src="js/inherited-controls.js?v=1" defer></script>
    <script src="js/portfolio-dashboard.js?v=1" defer></script>
    <script src="js/evidence-builder.js?v=1" defer></script>
    <script src="js/api-tester.js?v=1" defer></script>
    
    <!-- MSP Portal & Advanced Features -->
    <script src="js/msp-portal.js?v=1" defer></script>
    <script src="js/msp-portal-views.js?v=1" defer></script>
    <script src="js/rev3-crosswalk.js?v=1" defer></script>
    <script src="js/cmmc-l3-assessment.js?v=1" defer></script>
    
    <!-- Collaboration Modules (Local-first with optional Supabase) -->
    <script src="js/local-collaboration.js?v=1" defer></script>
    <script src="js/collaboration.js?v=1" defer></script>
    <script src="js/collaboration-manager.js?v=1" defer></script>
    <script src="js/user-management.js?v=1" defer></script>
    
    <!-- Gap Analysis & Workflow Automation -->
    <script src="js/gap-analysis.js?v=1" defer></script>
    <script src="js/gap-analysis-ui.js?v=1" defer></script>
    
    <!-- Evidence & Document Management -->
    <script src="js/document-parser.js?v=1" defer></script>
    
    <!-- Document Converter -->
    <script src="js/document-converter.js?v=1" defer></script>
    
    <!-- Assessment Enhancements -->
    <script src="js/assessment-enhancements.js?v=1" defer></script>
    
    <!-- Reporting & Analytics -->
    <script src="js/executive-dashboard.js?v=1" defer></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('[App] Service Worker registered'))
                    .catch(err => console.log('[App] Service Worker registration failed:', err));
            });
        }
    </script>
    
    <!-- Command Search Modal (Cmd+K) -->
    <div id="command-search-modal" class="command-search-overlay" style="display:none;">
        <div class="command-search-backdrop"></div>
        <div class="command-search-container">
            <div class="command-search-box">
                <div class="command-search-header">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    <input type="text" id="command-search-input" placeholder="Search controls, views, guides..." autocomplete="off" autocorrect="off" spellcheck="false">
                    <kbd class="command-search-kbd">ESC</kbd>
                </div>
                <div class="command-search-filters">
                    <button class="command-filter-btn active" data-filter="all">All</button>
                    <button class="command-filter-btn" data-filter="controls">Controls</button>
                    <button class="command-filter-btn" data-filter="views">Views</button>
                    <button class="command-filter-btn" data-filter="guides">Guides</button>
                </div>
                <div id="command-search-results" class="command-search-results">
                    <div class="command-search-empty">Type to search...</div>
                </div>
                <div class="command-search-footer">
                    <div class="command-footer-hint"><kbd>↑↓</kbd> Navigate</div>
                    <div class="command-footer-hint"><kbd>Enter</kbd> Select</div>
                    <div class="command-footer-hint"><kbd>Esc</kbd> Close</div>
                </div>
            </div>
        </div>
    </div>

    <!-- API Tester Quick Access Button -->
    <button class="api-tester-fab" onclick="APITester.open()" title="Open API Tester (Ctrl+Shift+A)">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
        </svg>
    </button>

    <!-- Permanent Footer Disclaimer -->
    <footer class="site-footer-disclaimer">
        <div class="footer-disclaimer-content">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
            <span><strong>Personal Use Only:</strong> This tool is provided solely for personal, non-commercial use. It is not intended for, and should not be used in, any commercial setting or for commercial purposes.</span>
        </div>
    </footer>
</body>
</html>

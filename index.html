<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIST 800-171A / CMMC L2 Assessment Tool</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css?v=7">
    <link rel="stylesheet" href="css/evidence.css?v=1">
    <link rel="stylesheet" href="css/theme-picker.css?v=1">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle menu">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
    </button>
    <div class="mobile-overlay" id="mobile-overlay"></div>
    
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>CMMC L2 Assessment</h1>
                <p>Self-Assessment & POA&M Generator</p>
            </div>
            <!-- Auth Container for Google SSO -->
            <div class="auth-container" id="auth-container">
                <!-- Auth UI rendered by evidence-ui.js -->
            </div>
            <div class="org-info-section">
                <div class="org-card assessor-card">
                    <div class="org-card-label">Assessor</div>
                    <div class="org-card-header">
                        <input type="text" id="org-assessor-name" class="org-name-input" placeholder="Company Name">
                    </div>
                    <div class="org-logo-display" id="assessor-logo-container">
                        <img id="assessor-logo-img" class="org-logo-large" style="display: none;" alt="Assessor Logo">
                        <div class="org-logo-placeholder-large" id="assessor-logo-placeholder">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                            <span>Click to upload or fetch from URL</span>
                        </div>
                    </div>
                    <div class="org-url-row">
                        <input type="text" id="org-assessor-url" class="org-url-input" placeholder="Website URL (e.g., example.com)">
                        <button id="fetch-assessor-logo-btn" class="fetch-logo-btn" title="Fetch logo from URL">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 11-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>
                        </button>
                    </div>
                    <input type="file" id="assessor-logo-input" accept="image/*" style="display: none;">
                </div>
                <div class="org-card osc-card">
                    <div class="org-card-label">Organization Seeking Certification</div>
                    <div class="org-card-header">
                        <input type="text" id="org-osc-name" class="org-name-input" placeholder="Company Name">
                    </div>
                    <div class="org-logo-display" id="osc-logo-container">
                        <img id="osc-logo-img" class="org-logo-large" style="display: none;" alt="OSC Logo">
                        <div class="org-logo-placeholder-large" id="osc-logo-placeholder">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                            <span>Click to upload or fetch from URL</span>
                        </div>
                    </div>
                    <div class="org-url-row">
                        <input type="text" id="org-osc-url" class="org-url-input" placeholder="Website URL (e.g., example.com)">
                        <button id="fetch-osc-logo-btn" class="fetch-logo-btn" title="Fetch logo from URL">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 11-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>
                        </button>
                    </div>
                    <input type="file" id="osc-logo-input" accept="image/*" style="display: none;">
                </div>
            </div>
            <nav class="sidebar-nav">
                <button class="nav-btn active" data-view="dashboard">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>
                    Dashboard
                </button>
                <button class="nav-btn" data-view="assessment">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
                    Assessment
                </button>
                <button class="nav-btn" data-view="poam">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                    POA&M
                </button>
            </nav>
            <div class="sidebar-footer">
                <!-- Theme Picker -->
                <div id="theme-picker-container"></div>
                <button id="export-btn" class="export-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    Export POA&M
                </button>
                <button id="save-btn" class="save-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                    Save Progress
                </button>
                <button id="load-btn" class="load-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                    Load Progress
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Assessment View -->
            <div id="assessment-view" class="view">
                <header class="view-header">
                    <div class="header-left">
                        <h2>Assessment Objectives</h2>
                        <p class="subtitle">Mark each objective as Met, Not Met, or Partial</p>
                    </div>
                    <div class="header-right">
                        <div class="search-box">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                            <input type="text" id="search-input" placeholder="Search objectives...">
                        </div>
                        <select id="filter-status" class="filter-select">
                            <option value="all">All Status</option>
                            <option value="not-assessed">Not Assessed</option>
                            <option value="met">Met</option>
                            <option value="not-met">Not Met</option>
                            <option value="partial">Partial</option>
                        </select>
                        <select id="filter-family" class="filter-select">
                            <option value="all">All Families</option>
                        </select>
                        <button id="mark-all-not-met-btn" class="action-btn warning">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
                            Mark All Not Met
                        </button>
                        <button id="export-assessment-btn" class="action-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                            Export Assessment
                        </button>
                    </div>
                </header>
                <div class="progress-bar-container">
                    <div class="progress-stats">
                        <span id="progress-text">0 of 0 assessed</span>
                        <span id="compliance-text">0% compliant</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-met" id="progress-met"></div>
                        <div class="progress-partial" id="progress-partial"></div>
                        <div class="progress-not-met" id="progress-not-met"></div>
                    </div>
                </div>
                <div id="controls-list" class="controls-list"></div>
            </div>

            <!-- POA&M View -->
            <div id="poam-view" class="view">
                <header class="view-header">
                    <div class="header-left">
                        <h2>Plan of Action & Milestones</h2>
                        <p class="subtitle">Items marked as Not Met or Partial</p>
                    </div>
                    <div class="header-right">
                        <button id="export-csv-btn" class="action-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                            Export CSV
                        </button>
                    </div>
                </header>
                <div id="poam-content" class="poam-content"></div>
            </div>

            <!-- Dashboard View -->
            <div id="dashboard-view" class="view active">
                <header class="view-header">
                    <div class="header-left">
                        <h2>Compliance Dashboard</h2>
                        <p class="subtitle">Overview of assessment status by control family</p>
                    </div>
                </header>
                <div id="dashboard-content" class="dashboard-content"></div>
            </div>
        </main>
    </div>

    <!-- Modal for Implementation Notes (Assessment View) -->
    <div id="implementation-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Implementation Details</h3>
                <button class="modal-close" onclick="app.closeImplementationModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="implementation-form">
                    <input type="hidden" id="impl-objective-id">
                    <div class="form-group">
                        <label>Control / Objective</label>
                        <input type="text" id="impl-control-id" readonly>
                    </div>
                    <div class="form-group">
                        <label>Objective Requirement</label>
                        <textarea id="impl-requirement" rows="2" readonly></textarea>
                    </div>
                    <div class="form-group">
                        <label>How is this objective met?</label>
                        <textarea id="impl-description" rows="4" placeholder="Describe how this control objective is implemented..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Evidence / Documentation</label>
                        <textarea id="impl-evidence" rows="3" placeholder="Reference policies, procedures, screenshots, or other evidence..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Responsible Party</label>
                            <input type="text" id="impl-responsible" placeholder="Name or role...">
                        </div>
                        <div class="form-group">
                            <label>Last Verified</label>
                            <input type="date" id="impl-verified-date">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Additional Notes</label>
                        <textarea id="impl-notes" rows="2" placeholder="Any additional notes..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-cancel" onclick="app.closeImplementationModal()">Cancel</button>
                        <button type="submit" class="btn-save">Save Implementation Details</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal for POA&M Details -->
    <div id="poam-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>POA&M Entry Details</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="poam-form">
                    <input type="hidden" id="poam-objective-id">
                    <div class="form-group">
                        <label>Control ID</label>
                        <input type="text" id="poam-control-id" readonly>
                    </div>
                    <div class="form-group">
                        <label>Weakness Description</label>
                        <textarea id="poam-weakness" rows="3" placeholder="Describe the weakness or gap..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Weakness Identifying Party</label>
                        <select id="poam-identifying-party">
                            <option value="">-- Select --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Remediation Plan</label>
                        <textarea id="poam-remediation" rows="3" placeholder="Describe the plan to address this weakness..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Scheduled Completion Date</label>
                            <input type="date" id="poam-date">
                        </div>
                        <div class="form-group">
                            <label>Responsible Party</label>
                            <input type="text" id="poam-responsible" placeholder="Name or role...">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Risk Level</label>
                            <select id="poam-risk">
                                <option value="low">Low</option>
                                <option value="moderate">Moderate</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Estimated Cost</label>
                            <input type="text" id="poam-cost" placeholder="$0.00">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="poam-notes" rows="2" placeholder="Additional notes..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-cancel">Cancel</button>
                        <button type="submit" class="btn-save">Save POA&M Entry</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Cmd+K Search Modal -->
    <div id="search-modal" class="search-modal">
        <div class="search-modal-backdrop"></div>
        <div class="search-modal-content">
            <div class="search-modal-header">
                <div class="search-input-wrapper">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    <input type="text" id="search-modal-input" placeholder="Search controls, objectives, or keywords..." autocomplete="off">
                    <kbd class="search-kbd">ESC</kbd>
                </div>
            </div>
            <div class="search-modal-results" id="search-modal-results">
                <div class="search-empty-state">
                    <p>Start typing to search across all controls and objectives</p>
                    <div class="search-hints">
                        <span><kbd>↑</kbd><kbd>↓</kbd> Navigate</span>
                        <span><kbd>Enter</kbd> Select</span>
                        <span><kbd>ESC</kbd> Close</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Storage Notice -->
    <div id="data-storage-notice" class="data-storage-notice">
        <div class="notice-content">
            <div class="notice-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            </div>
            <div class="notice-text">
                <strong>Your data stays in your browser</strong>
                <p>Favorites, notes, and preferences are saved locally using browser storage. No data is sent to our servers. Avoid storing sensitive information as browser data can be accessed by other scripts or cleared unexpectedly.</p>
            </div>
            <button id="acknowledge-notice-btn" class="acknowledge-btn">Acknowledged</button>
        </div>
    </div>

    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="data/families-ac-at-au.js"></script>
    <script src="data/families-cm-ia.js"></script>
    <script src="data/families-ir-ma-mp-ps-pe.js"></script>
    <script src="data/families-ra-ca-sc-si.js"></script>
    <script src="data/sprs-scoring.js"></script>
    <script src="data/ctrl-xref.js?v=2"></script>
    <script src="data/gcc-high-guidance.js?v=2"></script>
    <script src="data/aws-govcloud-guidance.js?v=2"></script>
    <script src="data/gcp-guidance.js?v=2"></script>
    <script src="data/cca-questions.js?v=1"></script>
    <script src="data/fedramp-services.js?v=1"></script>
    <script src="data/related-objectives.js?v=1"></script>
    <script src="data/itar-guidance.js?v=1"></script>
    <script src="data/framework-mappings.js?v=1"></script>
    <script src="data/loader.js"></script>
    <script src="app.js?v=10"></script>
    <script src="js/supabase-client.js?v=1"></script>
    <script src="js/evidence-ui.js?v=1"></script>
    <script src="js/theme-picker.js?v=1"></script>
</body>
</html>
